<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Efax Dashboard for PDF management">
    <title>Efax Dashboard</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Custom Styles */
        .table-hover tbody tr:hover {
            background-color: #f5f5f5;
        }

        .navbar-brand {
            font-weight: bold;
        }

        .logout-btn {
            margin-left: auto;
        }

        .sidebar {
            min-height: 100vh;
            background-color: #f8f9fa;
            padding: 20px;
        }

        .metrics-card {
            height: 150px;
        }

        .hidden {
            display: none;
        }
    </style>
</head>

<body>
    <!-- Navbar with Logout Button -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#">Efax Dashboard</a>
        <div class="collapse navbar-collapse">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a href="{{ url_for('logout') }}" class="btn btn-danger logout-btn">Logout</a>
                </li>
            </ul>
        </div>
    </nav>

    <div class="container mt-5">
        <div class="row">
            <!-- Sidebar Navigation -->
            <div class="col-md-3 sidebar">
                <h4>Menu</h4>
                <ul class="list-group">
                    <li class="list-group-item">
                        <a href="#" class="nav-link" onclick="showSection('dashboard')">Dashboard</a>
                    </li>
                    <li class="list-group-item">
                        <a href="#" class="nav-link" onclick="showSection('workbench')">Workbench</a>
                    </li>
                </ul>
            </div>

            <!-- Main Content -->
            <div class="col-md-9">
                <!-- Dashboard Section -->
                <div id="dashboard" class="section mb-5">
                    <h2 class="text-center mb-4">Efax Dashboard</h2>

                    <!-- Date Filter -->
                    <form method="POST" action="{{ url_for('dashboard') }}" class="mb-3">
                        <div class="form-group">
                            <label for="date_filter">Select by Date:</label>
                            <input type="date" name="date_filter" id="date_filter" class="form-control" value="{{ selected_date }}">
                        </div>
                        <button type="submit" class="btn btn-primary">Apply Filter</button>
                        <a href="{{ url_for('download_excel') }}?date_filter={{ selected_date }}" class="btn btn-success">Download as Excel</a>
                    </form>

                    <!-- Metrics Cards -->
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="card bg-primary text-white metrics-card mb-3">
                                <div class="card-header">Total PDFs</div>
                                <div class="card-body">
                                    <h5 class="card-title">{{ total_pdfs }}</h5>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-success text-white metrics-card mb-3">
                                <div class="card-header">Completed Files</div>
                                <div class="card-body">
                                    <h5 class="card-title">{{ completed_files }}</h5>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-warning text-white metrics-card mb-3">
                                <div class="card-header">Pending Files</div>
                                <div class="card-body">
                                    <h5 class="card-title">{{ pending_files }}</h5>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-danger text-white metrics-card mb-3">
                                <div class="card-header">Exception Files</div>
                                <div class="card-body">
                                    <h5 class="card-title">{{ exception_files }}</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Workbench Section -->
                <div id="workbench" class="section hidden">
                    <h2 class="text-center mb-4">Workbench</h2>

                    <!-- PDF Data Table -->
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Subject</th>
                                <th>Attachment</th>
                                <th>Preview Status</th>
                                <th>Total Pages</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for pdf in pdf_data %}
                            <tr>
                                <td>{{ pdf[1] }}</td>
                                <td>{{ pdf[2] }}</td>
                                <td><a href="{{ url_for('view_pdf', filename=pdf[3]) }}">{{ pdf[3] }}</a></td>
                                <td>{{ pdf[4] }}</td>
                                <td>{{ pdf[5] }}</td>
                                <td>
                                    <form method="POST" action="{{ url_for('update_status') }}" onsubmit="return confirmStatusChange(this)">
                                        <input type="hidden" name="pdf_id" value="{{ pdf[0] }}">
                                        <select name="status" class="form-control d-inline" style="width: auto;">
                                            <option value="Completed">Completed</option>
                                            <option value="Pending">Pending</option>
                                            <option value="Exception">Exception</option>
                                        </select>
                                        <button type="submit" class="btn btn-primary btn-sm">Update</button>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.0.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <!-- JavaScript for Section Display -->
    <script>
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(function(section) {
                section.classList.add('hidden');
            });

            // Show the selected section
            document.getElementById(sectionId).classList.remove('hidden');
        }

        function confirmStatusChange(form) {
            const status = form.status.value;
            const confirmation = confirm("Are you sure you want to change the status to " + status + "?");
            if (confirmation) {
                alert("Status changed to " + status);
                return true;  // Proceed with form submission
            } else {
                return false;  // Cancel form submission
            }
        }

        // Show the dashboard by default on page load
        document.addEventListener("DOMContentLoaded", function() {
            showSection('dashboard');
        });
    </script>
</body>

</html>
